---
import Card from './ui/Card.astro';
import { getTranslations, type SupportedLang } from '../lib/i18n';
import type { RecipientCategory } from '../types';

interface Props {
  category: RecipientCategory;
  count: number;
  country: string;
  lang?: SupportedLang;
}

const { category, count, country, lang = 'en' } = Astro.props;
const i18n = getTranslations(lang);
const baseUrl = lang === 'en' ? '' : `/${lang}`;

const categoryLabels: Record<RecipientCategory, string> = {
  journalist: i18n.categories.journalist,
  media: i18n.categories.media,
  government: i18n.categories.government,
  mp: i18n.categories.mp,
};

const categoryDescs: Record<RecipientCategory, string> = {
  journalist: i18n.categories.journalistDesc,
  media: i18n.categories.mediaDesc,
  government: i18n.categories.governmentDesc,
  mp: i18n.categories.mpDesc,
};

const categoryIcons: Record<RecipientCategory, string> = {
  journalist: 'üì∞',
  media: 'üì∫',
  government: 'üèõÔ∏è',
  mp: 'üó≥Ô∏è',
};

const categoryColors: Record<RecipientCategory, string> = {
  journalist: 'from-blue-500/20 to-blue-600/5 border-blue-500/30 hover:border-blue-400/50',
  media: 'from-purple-500/20 to-purple-600/5 border-purple-500/30 hover:border-purple-400/50',
  government: 'from-amber-500/20 to-amber-600/5 border-amber-500/30 hover:border-amber-400/50',
  mp: 'from-emerald-500/20 to-emerald-600/5 border-emerald-500/30 hover:border-emerald-400/50',
};

const isDisabled = count === 0;
const href = isDisabled ? undefined : `${baseUrl}/${country}/${category}`;
---

<Card
  href={href}
  variant="bordered"
  padding="lg"
  class={`
    group relative overflow-hidden transition-all duration-300
    bg-gradient-to-br ${categoryColors[category]}
    ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'hover:scale-[1.02] hover:shadow-xl hover:shadow-primary/10'}
  `}
>
  <!-- Background glow effect -->
  <div 
    class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
    aria-hidden="true"
  />
  
  <div class="relative flex items-start gap-md">
    <span 
      class="text-4xl flex-shrink-0 transform group-hover:scale-110 transition-transform duration-300" 
      role="img" 
      aria-hidden="true"
    >
      {categoryIcons[category]}
    </span>
    
    <div class="flex-1 min-w-0">
      <h3 class="text-lg font-semibold text-text mb-xs group-hover:text-primary transition-colors duration-200">
        {categoryLabels[category]}
      </h3>
      <p class="text-sm text-text/60 mb-sm line-clamp-2">
        {categoryDescs[category]}
      </p>
      <div class="flex items-center gap-sm">
        <span class={`
          inline-flex items-center gap-xs px-sm py-[2px] rounded-full text-xs font-medium
          ${count > 0 ? 'bg-primary/20 text-primary' : 'bg-white/10 text-text/40'}
        `}>
          <span class="font-bold">{count}</span>
          <span>{i18n.wizard.recipientsInCategory}</span>
        </span>
      </div>
    </div>
    
    {!isDisabled && (
      <span 
        class="text-text/40 group-hover:text-primary group-hover:translate-x-1 rtl:group-hover:-translate-x-1 transition-all duration-200 flex-shrink-0"
        aria-hidden="true"
      >
        ‚Üí
      </span>
    )}
  </div>
</Card>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

