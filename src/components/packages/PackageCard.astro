---
/**
 * PackageCard - Luxury email package display card
 * Features glass morphism, smooth animations, and contextual coloring
 */
import Badge from '../ui/Badge.astro';
import type { EmailPackage, PackageColor, PackageBadge } from '../../types';
import { getLocalizedValue, getLocalizedKeywords } from '../../types/package';
import type { SupportedLang } from '../../lib/i18n';

interface Props {
  package: EmailPackage;
  lang?: SupportedLang;
  recipientCount?: number;
  class?: string;
}

const { 
  package: pkg, 
  lang = 'en',
  recipientCount,
  class: className = '' 
} = Astro.props;

const title = getLocalizedValue(pkg.display.title, lang);
const description = getLocalizedValue(pkg.display.description, lang);
const keywords = getLocalizedKeywords(pkg.display.keywords, lang);
const actualRecipientCount = recipientCount ?? pkg.recipients.ids.length;

// Color configurations for glow effects
const colorConfig: Record<PackageColor, { glow: string; border: string; text: string }> = {
  red: { glow: 'hover:shadow-red-500/20', border: 'border-red-500/30', text: 'text-red-400' },
  blue: { glow: 'hover:shadow-blue-500/20', border: 'border-blue-500/30', text: 'text-blue-400' },
  green: { glow: 'hover:shadow-green-500/20', border: 'border-green-500/30', text: 'text-green-400' },
  purple: { glow: 'hover:shadow-purple-500/20', border: 'border-purple-500/30', text: 'text-purple-400' },
  amber: { glow: 'hover:shadow-amber-500/20', border: 'border-amber-500/30', text: 'text-amber-400' },
  emerald: { glow: 'hover:shadow-emerald-500/20', border: 'border-emerald-500/30', text: 'text-emerald-400' },
};

const colors = colorConfig[pkg.ui.color] || colorConfig.blue;

// Badge variant mapping
const badgeVariants: Record<PackageBadge, 'urgent' | 'new' | 'featured' | 'success' | 'warning'> = {
  'URGENT': 'urgent',
  'NEW': 'new',
  'FEATURED': 'featured',
  'HIGH_IMPACT': 'success',
  'TRENDING': 'warning',
};
---

<article
  class:list={[
    'group relative flex flex-col',
    'bg-surface/80 backdrop-blur-sm',
    'border rounded-lg overflow-hidden',
    'transition-all duration-300 ease-out',
    'hover:transform hover:-translate-y-1 hover:scale-[1.02]',
    'hover:shadow-2xl hover:shadow-black/30',
    colors.border,
    colors.glow,
    className
  ]}
>
  <!-- Gradient overlay on hover -->
  <div class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" />
  
  <!-- Content -->
  <div class="relative p-md flex flex-col flex-1">
    <!-- Header with icon and badge -->
    <div class="flex items-start justify-between gap-sm mb-sm">
      <div class="flex items-center gap-sm">
        <span class="text-2xl" role="img" aria-hidden="true">{pkg.display.icon}</span>
        <span class:list={['text-xs font-medium uppercase tracking-wider', colors.text]}>
          {pkg.meta.type}
        </span>
      </div>
      {pkg.ui.badge && (
        <Badge variant={badgeVariants[pkg.ui.badge]} pulse={pkg.ui.badge === 'URGENT'}>
          {pkg.ui.badge}
        </Badge>
      )}
    </div>
    
    <!-- Title -->
    <h3 class="text-lg font-bold text-text mb-xs leading-tight">
      {title}
    </h3>
    
    <!-- Description (truncated) -->
    <p class="text-sm text-text/60 mb-md line-clamp-2 flex-1">
      {description}
    </p>
    
    <!-- Keywords -->
    <div class="flex flex-wrap gap-1 mb-md">
      {keywords.slice(0, 3).map((keyword) => (
        <span class="px-2 py-0.5 text-[10px] bg-white/5 text-text/50 rounded-full border border-white/10">
          #{keyword}
        </span>
      ))}
    </div>
    
    <!-- Footer with recipient info -->
    <div class="flex items-center justify-between pt-sm border-t border-white/10">
      <div class="flex items-center gap-xs text-sm text-text/50">
        <span>üë•</span>
        <span>{actualRecipientCount} recipients</span>
      </div>
      <div class="flex items-center gap-xs">
        {pkg.recipients.categories.slice(0, 2).map((cat) => (
          <span class="text-xs text-text/40">
            {cat === 'journalist' ? 'üì∞' : cat === 'media' ? 'üì∫' : cat === 'government' ? 'üèõÔ∏è' : 'üó≥Ô∏è'}
          </span>
        ))}
      </div>
    </div>
  </div>
  
  <!-- Actions -->
  <div class="flex border-t border-white/10">
    <button
      type="button"
      class="flex-1 py-sm text-sm font-medium text-text/70 hover:text-text hover:bg-white/5 transition-colors"
      data-action="preview"
      data-package-id={pkg.id}
    >
      üëÅÔ∏è Preview
    </button>
    <div class="w-px bg-white/10" />
    <button
      type="button"
      class:list={[
        'flex-1 py-sm text-sm font-medium transition-colors',
        colors.text,
        'hover:bg-white/5'
      ]}
      data-action="send"
      data-package-id={pkg.id}
    >
      ‚úâÔ∏è Send Now
    </button>
  </div>
</article>

<style>
  /* Line clamp utility */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

