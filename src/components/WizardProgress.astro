---
import { getTranslations, type SupportedLang } from '../lib/i18n';
import type { WizardStep } from '../types';

interface Props {
  currentStep: WizardStep;
  lang?: SupportedLang;
  country?: string;
  category?: string;
}

const { currentStep, lang = 'en', country, category } = Astro.props;
const i18n = getTranslations(lang);
const baseUrl = lang === 'en' ? '' : `/${lang}`;

const steps: { id: WizardStep; label: string; href?: string }[] = [
  { id: 'country', label: i18n.wizard.step1, href: `${baseUrl}/` },
  { id: 'category', label: i18n.wizard.step2, href: country ? `${baseUrl}/${country}/categories` : undefined },
  { id: 'recipients', label: i18n.wizard.step3, href: category ? `${baseUrl}/${country}/${category}` : undefined },
  { id: 'template', label: i18n.wizard.step4 },
  { id: 'compose', label: i18n.wizard.step5 },
];

const stepOrder = ['country', 'category', 'recipients', 'template', 'compose'];
const currentIdx = stepOrder.indexOf(currentStep);

function getStepState(stepId: WizardStep): 'complete' | 'current' | 'upcoming' {
  const idx = stepOrder.indexOf(stepId);
  if (idx < currentIdx) return 'complete';
  if (idx === currentIdx) return 'current';
  return 'upcoming';
}
---

<nav 
  aria-label={i18n.accessibility.wizardProgress} 
  class="mb-lg"
>
  <ol class="flex items-center justify-between max-w-2xl mx-auto">
    {steps.map((step, idx) => {
      const state = getStepState(step.id);
      const isLast = idx === steps.length - 1;
      
      return (
        <li class="flex items-center flex-1">
          <div class="flex flex-col items-center text-center flex-shrink-0">
            {step.href && state === 'complete' ? (
              <a
                href={step.href}
                class={`
                  w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold
                  transition-all duration-300 min-h-[44px] min-w-[44px]
                  bg-primary text-white hover:bg-primary/80
                `}
                aria-current={state === 'current' ? 'step' : undefined}
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </a>
            ) : (
              <div
                class={`
                  w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold
                  transition-all duration-300
                  ${state === 'current' ? 'bg-primary text-white ring-4 ring-primary/30' : ''}
                  ${state === 'upcoming' ? 'bg-surface border-2 border-white/20 text-text/50' : ''}
                  ${state === 'complete' ? 'bg-primary text-white' : ''}
                `}
                aria-current={state === 'current' ? 'step' : undefined}
              >
                {state === 'complete' ? (
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                ) : (
                  <span>{idx + 1}</span>
                )}
              </div>
            )}
            <span 
              class={`
                mt-xs text-xs font-medium hidden sm:block
                ${state === 'current' ? 'text-primary' : ''}
                ${state === 'upcoming' ? 'text-text/40' : ''}
                ${state === 'complete' ? 'text-text/70' : ''}
              `}
            >
              {step.label}
            </span>
          </div>
          
          {!isLast && (
            <div 
              class={`
                flex-1 h-[2px] mx-sm transition-colors duration-300
                ${stepOrder.indexOf(step.id) < currentIdx ? 'bg-primary' : 'bg-white/10'}
              `}
              aria-hidden="true"
            />
          )}
        </li>
      );
    })}
  </ol>
</nav>

