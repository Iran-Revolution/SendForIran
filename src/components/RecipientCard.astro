---
import Card from './ui/Card.astro';
import { getTranslations, type SupportedLang } from '../lib/i18n';
import type { Recipient } from '../types';

interface Props {
  recipient: Recipient;
  selected?: boolean;
  lang?: SupportedLang;
}

const { recipient, selected = false, lang = 'en' } = Astro.props;
const i18n = getTranslations(lang);

/** Type badge colors */
const typeBadgeColors: Record<string, string> = {
  journalist: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  media: 'bg-purple-500/20 text-purple-400 border-purple-500/30',
  government: 'bg-amber-500/20 text-amber-400 border-amber-500/30',
  mp: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',
};

/** Priority indicators */
const priorityDisplay: Record<number, { icon: string; class: string }> = {
  1: { icon: '⭐', class: 'text-amber-400' },
  2: { icon: '•', class: 'text-text/60' },
  3: { icon: '•', class: 'text-text/30' },
};

const typeLabel = i18n.recipients[recipient.type as keyof typeof i18n.recipients] || recipient.type;
const priority = priorityDisplay[recipient.priority] || priorityDisplay[2];
const selectedClass = selected ? 'ring-2 ring-primary ring-offset-2 ring-offset-bg' : '';
---

<Card 
  variant="bordered" 
  padding="md"
  class={`cursor-pointer hover:border-primary/50 group ${selectedClass}`}
  data-recipient-id={recipient.id}
  data-recipient-email={recipient.email}
  data-recipient-name={recipient.name}
>
  <div class="flex items-start gap-sm">
    <!-- Priority Indicator -->
    <span class={`text-lg ${priority.class}`} aria-label={i18n.recipients.priority}>
      {priority.icon}
    </span>
    
    <!-- Main Content -->
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-sm flex-wrap mb-xs">
        <h3 class="font-semibold text-text group-hover:text-primary transition-colors truncate">
          {recipient.name}
        </h3>
        <!-- Type Badge -->
        <span class={`text-xs px-sm py-[2px] rounded-xs border ${typeBadgeColors[recipient.type]}`}>
          {typeLabel}
        </span>
      </div>
      
      <p class="text-sm text-text/70 truncate">
        {recipient.title}
      </p>
      <p class="text-sm text-text/50 truncate">
        {recipient.organization}
      </p>
    </div>

    <!-- Selection Indicator -->
    <div class="opacity-0 group-hover:opacity-100 transition-opacity text-primary">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </div>
  </div>
</Card>

<style>
  [data-recipient-id] {
    transition: all 0.2s ease;
  }
</style>

