---
/**
 * Package Selection Page - German version
 */
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Button from '../../../components/ui/Button.astro';
import Card from '../../../components/ui/Card.astro';
import PackageSelector from '../../../islands/PackageSelector.tsx';
import { getTranslations, type SupportedLang } from '../../../lib/i18n';
import { loadPackagesForCountry, loadRecipientsForCountry } from '../../../lib/packages';
import { countryCodes } from '../../../lib/data';
import type { CountryCode } from '../../../types';

export function getStaticPaths() {
  return countryCodes.map((country) => ({
    params: { country },
  }));
}

interface Props {
  country: CountryCode;
}

const { country } = Astro.params as Props;
const lang: SupportedLang = 'de';
const i18n = getTranslations(lang);

const packages = await loadPackagesForCountry(country as CountryCode);
const recipients = await loadRecipientsForCountry(country as CountryCode);

const countryName = i18n.countries[country as keyof typeof i18n.countries] || country;
const baseUrl = '/de';

const labels = {
  preview: i18n.packages.preview,
  sendNow: i18n.packages.sendNow,
  sendToAll: i18n.packages.sendToAll,
  recipients: i18n.packages.recipients,
  rollDice: i18n.packages.rollDice,
  rolling: i18n.packages.rolling,
  close: i18n.packages.close,
  whyThisPackage: i18n.packages.whyThisPackage,
  sources: i18n.packages.sources,
  emailPreview: i18n.packages.emailPreview,
  viewAsGrid: i18n.packages.viewAsGrid,
  viewAsDice: i18n.packages.viewAsDice,
};

const emailServiceLabels = {
  chooseService: i18n.emailService.chooseService,
  gmail: i18n.emailService.gmail,
  outlook: i18n.emailService.outlook,
  yahoo: i18n.emailService.yahoo,
  defaultEmail: i18n.emailService.defaultEmail,
  copyToClipboard: i18n.emailService.copyToClipboard,
  copied: i18n.emailService.copied,
  sendVia: i18n.emailService.sendVia,
};
---

<BaseLayout 
  title={`${i18n.packages.title} - ${countryName}`} 
  lang={lang} 
  currentPath={`${baseUrl}/packages/${country}`}
>
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-xl">
      <Button href={baseUrl} variant="secondary" class="mb-md text-sm">
        ‚Üê {i18n.actions.back}
      </Button>
      
      <h1 class="text-3xl md:text-4xl font-bold text-text mb-sm">
        {i18n.packages.title}
      </h1>
      <p class="text-xl text-text/70 mb-xs">{countryName}</p>
      <p class="text-text/50">{i18n.packages.subtitle}</p>
    </div>

    <div class="flex justify-center mb-lg">
      <Card variant="bordered" padding="sm" class="inline-flex gap-xs">
        {countryCodes.map((c) => (
          <a
            href={`${baseUrl}/packages/${c}`}
            class:list={[
              'px-md py-sm rounded-lg text-sm font-medium transition-all',
              c === country 
                ? 'bg-primary text-white' 
                : 'text-text/50 hover:text-text hover:bg-white/5'
            ]}
          >
            {i18n.countries[c as keyof typeof i18n.countries] || c}
          </a>
        ))}
      </Card>
    </div>

    {packages.length > 0 ? (
      <PackageSelector
        client:load
        packages={packages}
        recipients={recipients}
        country={country as CountryCode}
        lang={lang}
        mode="grid"
        labels={labels}
        emailServiceLabels={emailServiceLabels}
      />
    ) : (
      <div class="text-center py-2xl">
        <div class="text-6xl mb-lg opacity-50">üì≠</div>
        <p class="text-text/50 text-xl mb-sm">{i18n.packages.noPackages}</p>
        <p class="text-text/30">{i18n.packages.checkBack}</p>
        <Button href={baseUrl} variant="secondary" class="mt-lg">
          {i18n.actions.back}
        </Button>
      </div>
    )}

  </div>
</BaseLayout>

