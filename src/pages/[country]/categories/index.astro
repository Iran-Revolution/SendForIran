---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import WizardProgress from '../../../components/WizardProgress.astro';
import CategoryCard from '../../../components/CategoryCard.astro';
import Button from '../../../components/ui/Button.astro';
import { getTranslations, type SupportedLang } from '../../../lib/i18n';
import { getCategoryCounts, countryCodes, allCategories } from '../../../lib/data';
import type { CountryCode, RecipientCategory } from '../../../types';

export function getStaticPaths() {
  return countryCodes.map((country) => ({
    params: { country },
  }));
}

interface Props {
  country: CountryCode;
}

const { country } = Astro.params as Props;
const lang: SupportedLang = 'en';
const i18n = getTranslations(lang);

const countryName = i18n.countries[country as keyof typeof i18n.countries] || country;
const categoryCounts = await getCategoryCounts(country);
const totalRecipients = Object.values(categoryCounts).reduce((a, b) => a + b, 0);
---

<BaseLayout title={`${countryName} - ${i18n.wizard.selectCategory}`} lang={lang} currentPath={`/${country}/categories`}>
  <div class="max-w-4xl mx-auto">
    <WizardProgress currentStep="category" lang={lang} country={country} />
    
    <!-- Header -->
    <div class="text-center mb-lg">
      <Button href="/" variant="secondary" class="mb-md text-sm">
        ← {i18n.actions.back}
      </Button>
      <h1 class="text-3xl md:text-4xl font-bold text-text mb-sm">
        {countryName}
      </h1>
      <p class="text-xl text-text/70 mb-xs">
        {i18n.wizard.selectCategory}
      </p>
      <p class="text-text/50">
        {i18n.wizard.categoryDesc} • {totalRecipients} {i18n.wizard.recipientsInCategory}
      </p>
    </div>

    <!-- Category Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-md">
      {allCategories.map((category: RecipientCategory) => (
        <CategoryCard
          category={category}
          count={categoryCounts[category]}
          country={country}
          lang={lang}
        />
      ))}
    </div>

    <!-- Quick tips -->
    <div class="mt-xl p-md rounded-md bg-surface/50 border border-white/10">
      <h3 class="text-sm font-semibold text-text/70 mb-sm flex items-center gap-xs">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
        </svg>
        Tips
      </h3>
      <ul class="text-sm text-text/50 space-y-xs">
        <li>• Journalists often respond best to newsworthy angles and human stories</li>
        <li>• Government officials may require more formal, policy-focused messaging</li>
        <li>• Media outlets appreciate well-sourced, factual information</li>
      </ul>
    </div>
  </div>
</BaseLayout>

